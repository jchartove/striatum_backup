function [Y,T] = odefun_20150511_175644
tspan=[0 5000]; dt=0.005;
T=tspan(1):dt:tspan(2); nstep=length(T);
fileID = 1; nreports = 5; enableLog = 1:(nstep-1)/nreports:nstep;enableLog(1) = [];
fprintf('\nSimulation interval: %g-%g\n',tspan);fprintf('Starting integration (euler, dt=%g)\n',dt);soma_soma_iSYN_width = inf;
soma_soma_iSYN_Nmax = max((200),(200));
soma_soma_iSYN_srcpos = linspace(1,soma_soma_iSYN_Nmax,(200))'*ones(1,(200));
soma_soma_iSYN_dstpos = (linspace(1,soma_soma_iSYN_Nmax,(200))'*ones(1,(200)))';
soma_soma_iSYN_netcon = rand((200),(200))<(0.3);
soma_soma_iSYN_netcon = soma_soma_iSYN_netcon.*(1-eye((200)));
dendrite_soma_iCOM_compcon = eye((200),(200));
dendrite_iMultiPoissonExp_Ge = multi_Poisson((200),(127),(2),(10),(1),2,.5,(2000),(0.005));
dendrite_iMultiPoissonExp_Gi = multi_Poisson((200),(73),(2),(10),(1),5,.5,(2000),(0.005));
soma_dendrite_iCOM_compcon = eye((200),(200));
dendrite_dendrite_iGAP_UB = max((200),(200));
dendrite_dendrite_iGAP_Xpre = linspace(1,dendrite_dendrite_iGAP_UB,(200))'*ones(1,(200));
dendrite_dendrite_iGAP_Xpost = (linspace(1,dendrite_dendrite_iGAP_UB,(200))'*ones(1,(200)))';
dendrite_dendrite_iGAP_mask = rand((200),(200))<(0.3);
dendrite_dendrite_iGAP_mask = dendrite_dendrite_iGAP_mask.*(1-eye((200)));
soma_K_an = @(soma_v) 0.01*(soma_v + 34)./(exp(0.1*(soma_v + 34))-1);
soma_K_bn = @(soma_v) 0.125*exp((soma_v + 44)/80);
soma_K_ik = @(soma_v,soma_K_n) (9)*(soma_K_n.^4).*(soma_v-(-90));
soma_Na_am = @(soma_v) .1*(soma_v+35)./(1-exp(-(soma_v+35)/10));
soma_Na_bm = @(soma_v) 4*exp(-(soma_v+60)/18);
soma_Na_ah = @(soma_v) .07*exp(-(soma_v+58)/20);
soma_Na_bh = @(soma_v) 1./(exp(0.1*(soma_v + 28)) + 1);
soma_Na_ina = @(soma_v,soma_Na_m,soma_Na_h) (35)*soma_Na_h.*(soma_Na_m.^3).*(soma_v-(55));
soma_leak_ileak = @(soma_v) (0.1)*(soma_v-(-65));
soma_soma_iSYN_ISYN = @(V,soma_soma_iSYN_s) (((0.3)/((200)*(0.3))).*(soma_soma_iSYN_netcon*soma_soma_iSYN_s).*(V-(-85)));
dendrite_soma_iCOM_dV = @(IN,OUT) ((IN*ones(1,size(IN,1)))'-(OUT*ones(1,size(OUT,1))));
dendrite_soma_iCOM_ICOM = @(IN,OUT) (0.15).*sum((((IN*ones(1,size(IN,1)))'-(OUT*ones(1,size(OUT,1))))).*dendrite_soma_iCOM_compcon,2);
dendrite_input_I = @(t) 10;
dendrite_iMultiPoissonExp_Gte = @(t) (0.1).*dendrite_iMultiPoissonExp_Ge(:,max(1,round(t/(0.005))));
dendrite_iMultiPoissonExp_Gti = @(t) (0.1).*dendrite_iMultiPoissonExp_Gi(:,max(1,round(t/(0.005))));
dendrite_iMultiPoissonExp_Itrain_e = @(t,dendrite_v) ((0.1).*dendrite_iMultiPoissonExp_Ge(:,max(1,round(t/(0.005))))).*(dendrite_v - (0));
dendrite_iMultiPoissonExp_Itrain_i = @(t,dendrite_v) ((0.1).*dendrite_iMultiPoissonExp_Gi(:,max(1,round(t/(0.005))))).*(dendrite_v - (-85));
dendrite_iMultiPoissonExp_Itrain = @(t,dendrite_v) (((0.1).*dendrite_iMultiPoissonExp_Ge(:,max(1,round(dendrite_v/(0.005))))).*(dendrite_v - (0))) + (((0.1).*dendrite_iMultiPoissonExp_Gi(:,max(1,round(dendrite_v/(0.005))))).*(dendrite_v - (-85)));
soma_dendrite_iCOM_dV = @(IN,OUT) ((IN*ones(1,size(IN,1)))'-(OUT*ones(1,size(OUT,1))));
soma_dendrite_iCOM_ICOM = @(IN,OUT) (0.15).*sum((((IN*ones(1,size(IN,1)))'-(OUT*ones(1,size(OUT,1))))).*soma_dendrite_iCOM_compcon,2);
dendrite_dendrite_iGAP_IGAP = @(V1,V2) ((0.3)/((0.3)*(200))).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*dendrite_dendrite_iGAP_mask,2);
soma_v = zeros(200,nstep);
soma_v(:,1) = [-65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65];
soma_K_n = zeros(200,nstep);
soma_K_n(:,1) = [0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317       0.317];
soma_Na_m = zeros(200,nstep);
soma_Na_m(:,1) = [0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052       0.052];
soma_Na_h = zeros(200,nstep);
soma_Na_h(:,1) = [0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596       0.596];
soma_soma_iSYN_s = zeros(200,nstep);
soma_soma_iSYN_s(:,1) = [0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1         0.1];
dendrite_v = zeros(200,nstep);
dendrite_v(:,1) = [-65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 -65];
tstart = tic;
for k=2:nstep
  t=T(k-1);
  F=((-((9)*(soma_K_n(:,k-1).^4).*(soma_v(:,k-1)-(-90))))+((-((35)*soma_Na_h(:,k-1).*(soma_Na_m(:,k-1).^3).*(soma_v(:,k-1)-(55))))+((-((0.1)*(soma_v(:,k-1)-(-65))))+((-((((0.3)/((200)*(0.3))).*(soma_soma_iSYN_netcon*soma_soma_iSYN_s(:,k-1)).*(soma_v(:,k-1)-(-85)))))+((((0.15).*sum((((dendrite_v(:,k-1)*ones(1,size(dendrite_v(:,k-1),1)))'-(soma_v(:,k-1)*ones(1,size(soma_v(:,k-1),1))))).*dendrite_soma_iCOM_compcon,2)))+0)))))/(1);
  soma_v(:,k) = soma_v(:,k-1) + dt*F;
  F=(0.01*(soma_v(:,k-1) + 34)./(exp(0.1*(soma_v(:,k-1) + 34))-1)).*(1-soma_K_n(:,k-1))-(0.125*exp((soma_v(:,k-1) + 44)/80)).*soma_K_n(:,k-1);
  soma_K_n(:,k) = soma_K_n(:,k-1) + dt*F;
  F=(.1*(soma_v(:,k-1)+35)./(1-exp(-(soma_v(:,k-1)+35)/10))).*(1-soma_Na_m(:,k-1))-(4*exp(-(soma_v(:,k-1)+60)/18)).*soma_Na_m(:,k-1);
  soma_Na_m(:,k) = soma_Na_m(:,k-1) + dt*F;
  F=(.07*exp(-(soma_v(:,k-1)+58)/20)).*(1-soma_Na_h(:,k-1))-(1./(exp(0.1*(soma_v(:,k-1) + 28)) + 1)).*soma_Na_h(:,k-1);
  soma_Na_h(:,k) = soma_Na_h(:,k-1) + dt*F;
  F=-soma_soma_iSYN_s(:,k-1)./(1) + ((1-soma_soma_iSYN_s(:,k-1))/(0.25)).*(1+tanh(soma_v(:,k-1)/10));
  soma_soma_iSYN_s(:,k) = soma_soma_iSYN_s(:,k-1) + dt*F;
  F=(((10))+((-((((0.1).*dendrite_iMultiPoissonExp_Ge(:,max(1,round(dendrite_v(:,k-1)/(0.005))))).*(dendrite_v(:,k-1) - (0))) + (((0.1).*dendrite_iMultiPoissonExp_Gi(:,max(1,round(dendrite_v(:,k-1)/(0.005))))).*(dendrite_v(:,k-1) - (-85)))))+((((0.15).*sum((((soma_v(:,k-1)*ones(1,size(soma_v(:,k-1),1)))'-(dendrite_v(:,k-1)*ones(1,size(dendrite_v(:,k-1),1))))).*soma_dendrite_iCOM_compcon,2)))+(((((0.3)/((0.3)*(200))).*sum(((dendrite_v(:,k-1)*ones(1,size(dendrite_v(:,k-1),1)))'-(dendrite_v(:,k-1)*ones(1,size(dendrite_v(:,k-1),1)))).*dendrite_dendrite_iGAP_mask,2)))+0))))/(1);;
  dendrite_v(:,k) = dendrite_v(:,k-1) + dt*F;
  if any(k == enableLog)
    elapsedTime = toc(tstart);
    elapsedTimeMinutes = floor(elapsedTime/60);
    elapsedTimeSeconds = rem(elapsedTime,60);
    if elapsedTimeMinutes
        fprintf(fileID,'Processed %g of %g ms (elapsed time: %g m %.3f s)\n',T(k),T(end),elapsedTimeMinutes,elapsedTimeSeconds);
    else
        fprintf(fileID,'Processed %g of %g ms (elapsed time: %.3f s)\n',T(k),T(end),elapsedTimeSeconds);
    end
  end
end
Y=cat(1,soma_v,soma_K_n,soma_Na_m,soma_Na_h,soma_soma_iSYN_s,dendrite_v)';
